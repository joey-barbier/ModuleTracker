<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Module Tracker - Demo (LibTracker iOS)</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #0d1117; color: #c9d1d9; padding: 20px; }
        .container { max-width: 1800px; margin: 0 auto; }
        h1 { color: #58a6ff; margin-bottom: 10px; }
        h2 { color: #8b949e; margin: 30px 0 15px; font-size: 18px; }
        .meta { color: #8b949e; font-size: 14px; margin-bottom: 20px; }

        /* Demo Banner */
        .demo-banner { background: linear-gradient(135deg, #238636 0%, #2ea043 100%); border-radius: 12px; padding: 20px 25px; margin-bottom: 25px; display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 15px; }
        .demo-banner-content h2 { color: #fff; margin: 0 0 5px 0; font-size: 20px; }
        .demo-banner-content p { color: rgba(255,255,255,0.9); font-size: 14px; margin: 0; }
        .demo-banner-badge { background: rgba(0,0,0,0.2); color: #fff; padding: 4px 10px; border-radius: 20px; font-size: 11px; font-weight: 600; margin-left: 10px; }
        .demo-banner-link { background: #fff; color: #238636; padding: 10px 20px; border-radius: 8px; text-decoration: none; font-weight: 600; font-size: 14px; transition: transform 0.2s; }
        .demo-banner-link:hover { transform: scale(1.05); }

        /* Tab Menu */
        .tabs { display: flex; gap: 5px; margin-bottom: 25px; border-bottom: 1px solid #30363d; padding-bottom: 0; }
        .tab { background: transparent; border: none; color: #8b949e; padding: 12px 20px; cursor: pointer; font-size: 14px; font-weight: 500; border-bottom: 2px solid transparent; margin-bottom: -1px; transition: all 0.2s; }
        .tab:hover { color: #c9d1d9; }
        .tab.active { color: #58a6ff; border-bottom-color: #58a6ff; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        /* Stats */
        .stats { display: flex; gap: 15px; margin-bottom: 25px; flex-wrap: wrap; }
        .stat { background: #161b22; padding: 12px 18px; border-radius: 8px; border: 1px solid #30363d; position: relative; }
        .stat-value { font-size: 24px; font-weight: bold; color: #58a6ff; }
        .stat-label { font-size: 11px; color: #8b949e; }
        .stat-delta { position: absolute; top: 8px; right: 8px; font-size: 11px; font-weight: 600; }
        .stat-delta.positive { color: #3fb950; }
        .stat-delta.negative { color: #f85149; }
        .stat-delta.neutral { color: #8b949e; }

        /* Filters */
        .filters { display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap; }
        input, select { background: #161b22; border: 1px solid #30363d; color: #c9d1d9; padding: 8px 12px; border-radius: 6px; font-size: 14px; }
        input:focus, select:focus { outline: none; border-color: #58a6ff; }

        /* Tables */
        table { width: 100%; border-collapse: collapse; background: #161b22; border-radius: 8px; overflow: hidden; margin-bottom: 30px; }
        th, td { padding: 10px 14px; text-align: left; border-bottom: 1px solid #30363d; font-size: 13px; }
        th { background: #21262d; color: #8b949e; font-weight: 600; }
        tr:hover { background: #1c2128; }
        tr.target-row { background: #0d1117; }
        tr.target-row td:first-child { padding-left: 40px; }

        /* Badges */
        .badge { display: inline-block; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: 500; }
        .badge-green { background: #238636; color: #fff; }
        .badge-yellow { background: #9e6a03; color: #fff; }
        .badge-orange { background: #bd5800; color: #fff; }
        .badge-red { background: #da3633; color: #fff; }
        .badge-blue { background: #1f6feb; color: #fff; }
        .badge-gray { background: #30363d; color: #8b949e; }
        .badge-purple { background: #8957e5; color: #fff; }
        .num { text-align: center; }
        .section-title { display: flex; align-items: center; gap: 10px; }
        .section-count { background: #30363d; padding: 2px 8px; border-radius: 10px; font-size: 12px; }
        .module-name { font-weight: bold; color: #58a6ff; }
        .target-name { color: #8b949e; font-size: 12px; }
        .expand-btn { color: #58a6ff; margin-right: 8px; }
        .module-row { cursor: pointer; }
        .module-row:hover { background: #21262d; }

        /* Charts */
        .charts-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(500px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .chart-card { background: #161b22; border: 1px solid #30363d; border-radius: 8px; padding: 20px; }
        .chart-card h3 { color: #c9d1d9; font-size: 14px; margin-bottom: 15px; }
        .chart-container { position: relative; height: 300px; }

        /* Comparison */
        .comparison-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px; margin-bottom: 30px; }
        .comparison-card { background: #161b22; border: 1px solid #30363d; border-radius: 8px; padding: 20px; }
        .comparison-card h4 { color: #8b949e; font-size: 12px; text-transform: uppercase; margin-bottom: 10px; }
        .comparison-row { display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid #21262d; }
        .comparison-row:last-child { border-bottom: none; }
        .comparison-label { color: #c9d1d9; font-size: 13px; }
        .comparison-values { display: flex; align-items: center; gap: 10px; }
        .comparison-old { color: #8b949e; font-size: 13px; }
        .comparison-arrow { color: #8b949e; }
        .comparison-new { font-weight: 600; font-size: 13px; }
        .comparison-delta { font-size: 12px; font-weight: 600; padding: 2px 6px; border-radius: 4px; }
        .delta-positive { background: rgba(63, 185, 80, 0.2); color: #3fb950; }
        .delta-negative { background: rgba(248, 81, 73, 0.2); color: #f85149; }
        .delta-neutral { background: rgba(139, 148, 158, 0.2); color: #8b949e; }

        .no-data { text-align: center; padding: 60px 20px; color: #8b949e; }
        .no-data-icon { font-size: 48px; margin-bottom: 15px; }

        /* Modal */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 100; }
        .modal.active { display: flex; align-items: center; justify-content: center; }
        .modal-content { background: #161b22; border: 1px solid #30363d; border-radius: 12px; padding: 25px; max-width: 600px; max-height: 80vh; overflow-y: auto; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .modal-close { background: none; border: none; color: #8b949e; font-size: 24px; cursor: pointer; }
        .modal-close:hover { color: #c9d1d9; }
        .field-info { margin-bottom: 15px; }
        .field-info h4 { color: #58a6ff; margin-bottom: 5px; }
        .field-info p { color: #8b949e; font-size: 13px; line-height: 1.5; }
    </style>
</head>
<body>
    <div class="container">
        <!-- Demo Banner -->
        <div class="demo-banner">
            <div class="demo-banner-content">
                <h2>LibTracker iOS App <span class="demo-banner-badge">DEMO</span></h2>
                <p>Fake data for demonstration purposes. This shows how Module Tracker visualizes architecture migration.</p>
            </div>
            <a href="https://github.com/joey-barbier/ModuleTracker" target="_blank" class="demo-banner-link">View on GitHub</a>
        </div>

        <h1>Module Tracker</h1>
        <div class="meta" id="meta">Loading...</div>

        <!-- Tab Menu -->
        <div class="tabs">
            <button class="tab active" onclick="switchTab('tables')">Tables</button>
            <button class="tab" onclick="switchTab('charts')">Charts</button>
            <button class="tab" onclick="switchTab('compare')">Compare</button>
        </div>

        <!-- Tables Tab -->
        <div class="tab-content active" id="tab-tables">
            <div class="stats" id="stats"></div>

            <h2 class="section-title">SPM Modules <span class="section-count" id="spm-count">0</span></h2>
            <div class="filters" id="filters"></div>
            <table id="spm-table">
                <thead id="spm-thead"></thead>
                <tbody id="spm-tbody"></tbody>
            </table>

            <div id="legacy-section" style="display:none;">
                <h2 class="section-title">Legacy Modules <span class="section-count" id="legacy-count">0</span></h2>
                <table id="legacy-table">
                    <thead id="legacy-thead"></thead>
                    <tbody id="legacy-tbody"></tbody>
                </table>
            </div>
        </div>

        <!-- Charts Tab -->
        <div class="tab-content" id="tab-charts">
            <div id="charts-container"></div>
        </div>

        <!-- Compare Tab -->
        <div class="tab-content" id="tab-compare">
            <div id="compare-container"></div>
        </div>
    </div>

    <div class="modal" id="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">Field Info</h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div id="modal-body"></div>
        </div>
    </div>

    <script>
        // ============================================================
        // DEMO DATA - Simulating LibTracker iOS App with fields_meta
        // This demonstrates the new data-driven approach
        // ============================================================
        const data = {
            "generated_at": "2025-12-25T10:30:00Z",
            "rules_version": "2.0",
            "modules_count": 14,
            "fields_meta": {
                "swift_version": {
                    "id": "swift_version",
                    "label": "Swift",
                    "description": "Swift tools version of the package (from Package.swift)",
                    "is_filterable": true,
                    "show_in_table": true,
                    "show_in_chart": true,
                    "show_in_comparison": true,
                    "inverted_comparison": false,
                    "chart_type": "bar",
                    "chart_color": "#f78166",
                    "level": "module",
                    "values": {
                        "6.0": { "label": "6.0", "color": "green", "description": "Swift 6.0 - Latest version with full concurrency checking" },
                        "5.9": { "label": "5.9", "color": "yellow", "description": "Swift 5.9 - Previous stable version, should migrate to 6.0" },
                        "5.8": { "label": "5.8", "color": "orange", "description": "Swift 5.8 - Older version, migration recommended" }
                    }
                },
                "swift_language_mode": {
                    "id": "swift_language_mode",
                    "label": "Lang Mode",
                    "description": "Swift language mode override per target (swiftLanguageMode in Package.swift)",
                    "is_filterable": true,
                    "show_in_table": true,
                    "show_in_chart": true,
                    "show_in_comparison": true,
                    "inverted_comparison": true,
                    "chart_type": "bar",
                    "chart_color": "#f0883e",
                    "level": "target",
                    "values": {
                        "6": { "label": "Swift 6", "color": "green", "description": "Full Swift 6 concurrency mode - target is fully migrated" },
                        "5": { "label": "Swift 5", "color": "orange", "description": "Swift 5 compatibility mode - target needs migration to Swift 6" },
                        "N/A": { "label": "N/A", "color": "gray", "description": "No language mode override - uses package default" }
                    }
                },
                "architecture_type": {
                    "id": "architecture_type",
                    "label": "Architecture",
                    "description": "Architectural pattern of the module",
                    "is_filterable": true,
                    "show_in_table": true,
                    "show_in_chart": true,
                    "show_in_comparison": true,
                    "inverted_comparison": false,
                    "chart_type": "area",
                    "chart_color": "#3fb950",
                    "values": {
                        "mvvmi": { "label": "MVVM-I", "color": "green", "description": "Modern MVVM with Interactor - clean separation of concerns with ViewModel + Interactor for business logic" },
                        "mvc": { "label": "MVC", "color": "orange", "description": "Legacy Model-View-Controller pattern - should be migrated to MVVM-I" },
                        "none": { "label": "None", "color": "gray", "description": "Utility module without UI layer (Foundation, Networking, etc.)" }
                    }
                },
                "navigation_type": {
                    "id": "navigation_type",
                    "label": "Navigation",
                    "description": "Navigation pattern used in the module",
                    "is_filterable": true,
                    "show_in_table": true,
                    "show_in_chart": true,
                    "show_in_comparison": true,
                    "inverted_comparison": false,
                    "chart_type": "area",
                    "chart_color": "#a371f7",
                    "values": {
                        "swiftui": { "label": "SwiftUI", "color": "green", "description": "Native SwiftUI navigation using NavigationStack or NavigationLink" },
                        "uikit": { "label": "UIKit", "color": "orange", "description": "Legacy UIKit navigation - should be migrated to SwiftUI" },
                        "N/A": { "label": "N/A", "color": "gray", "description": "Module without navigation (Domain, Mocks, Tests, utilities)" }
                    }
                },
                "test_framework": {
                    "id": "test_framework",
                    "label": "Tests",
                    "description": "Testing framework used in the module",
                    "is_filterable": true,
                    "show_in_table": true,
                    "show_in_chart": true,
                    "show_in_comparison": true,
                    "inverted_comparison": false,
                    "chart_type": "line",
                    "chart_color": "#58a6ff",
                    "values": {
                        "swift_testing": { "label": "Swift Testing", "color": "green", "description": "Modern Swift Testing framework using @Test macro - recommended" },
                        "xctest": { "label": "XCTest", "color": "orange", "description": "Legacy XCTest framework - should be migrated to Swift Testing" },
                        "mixed": { "label": "Mixed", "color": "yellow", "description": "Both Swift Testing and XCTest present - migration in progress" },
                        "none": { "label": "None", "color": "gray", "description": "No tests found in this module" }
                    }
                }
            },
            "spm_modules": [
                {
                    "name": "LTFoundation",
                    "source": "spm",
                    "is_modularized": true,
                    "custom_fields": { "swift_version": "6.0" },
                    "targets": [
                        { "name": "LTFoundation", "swift_language_mode": "6", "test_framework": "swift_testing", "navigation_type": "N/A", "architecture_type": "none" }
                    ]
                },
                {
                    "name": "LTLogger",
                    "source": "spm",
                    "is_modularized": true,
                    "custom_fields": { "swift_version": "6.0" },
                    "targets": [
                        { "name": "LTLogger", "swift_language_mode": "6", "test_framework": "swift_testing", "navigation_type": "N/A", "architecture_type": "none" }
                    ]
                },
                {
                    "name": "LTDesignSystem",
                    "source": "spm",
                    "is_modularized": true,
                    "custom_fields": { "swift_version": "6.0" },
                    "targets": [
                        { "name": "LTDesignSystem", "swift_language_mode": "6", "test_framework": "swift_testing", "navigation_type": "N/A", "architecture_type": "none" }
                    ]
                },
                {
                    "name": "LTNetworking",
                    "source": "spm",
                    "is_modularized": true,
                    "custom_fields": { "swift_version": "6.0" },
                    "targets": [
                        { "name": "LTNetworking", "swift_language_mode": "6", "test_framework": "swift_testing", "navigation_type": "N/A", "architecture_type": "mvvmi" },
                        { "name": "LTNetworkingMocks", "swift_language_mode": "5", "test_framework": "swift_testing", "navigation_type": "N/A", "architecture_type": "mvvmi" },
                        { "name": "LTNetworkingTests", "swift_language_mode": "6", "test_framework": "swift_testing", "navigation_type": "N/A", "architecture_type": "mvvmi" }
                    ]
                },
                {
                    "name": "LTStorage",
                    "source": "spm",
                    "is_modularized": true,
                    "custom_fields": { "swift_version": "6.0" },
                    "targets": [
                        { "name": "LTStorage", "swift_language_mode": "6", "test_framework": "swift_testing", "navigation_type": "N/A", "architecture_type": "mvvmi" },
                        { "name": "LTStorageTests", "swift_language_mode": "6", "test_framework": "swift_testing", "navigation_type": "N/A", "architecture_type": "mvvmi" }
                    ]
                },
                {
                    "name": "LTAuth",
                    "source": "spm",
                    "is_modularized": true,
                    "custom_fields": { "swift_version": "6.0" },
                    "targets": [
                        { "name": "LTAuth", "swift_language_mode": "6", "test_framework": "swift_testing", "navigation_type": "swiftui", "architecture_type": "mvvmi" },
                        { "name": "LTAuthDomain", "swift_language_mode": "5", "test_framework": "swift_testing", "navigation_type": "N/A", "architecture_type": "mvvmi" },
                        { "name": "LTAuthMocks", "swift_language_mode": "5", "test_framework": "swift_testing", "navigation_type": "N/A", "architecture_type": "mvvmi" },
                        { "name": "LTAuthTests", "swift_language_mode": "6", "test_framework": "swift_testing", "navigation_type": "N/A", "architecture_type": "mvvmi" }
                    ]
                },
                {
                    "name": "LTScanner",
                    "source": "spm",
                    "is_modularized": true,
                    "custom_fields": { "swift_version": "6.0" },
                    "targets": [
                        { "name": "LTScanner", "swift_language_mode": "6", "test_framework": "swift_testing", "navigation_type": "swiftui", "architecture_type": "mvvmi" },
                        { "name": "LTScannerDomain", "swift_language_mode": "6", "test_framework": "swift_testing", "navigation_type": "N/A", "architecture_type": "mvvmi" },
                        { "name": "LTScannerTests", "swift_language_mode": "6", "test_framework": "swift_testing", "navigation_type": "N/A", "architecture_type": "mvvmi" }
                    ]
                },
                {
                    "name": "LTLibraryList",
                    "source": "spm",
                    "is_modularized": true,
                    "custom_fields": { "swift_version": "6.0" },
                    "targets": [
                        { "name": "LTLibraryList", "swift_language_mode": "6", "test_framework": "swift_testing", "navigation_type": "swiftui", "architecture_type": "mvvmi" },
                        { "name": "LTLibraryListDomain", "swift_language_mode": "6", "test_framework": "swift_testing", "navigation_type": "N/A", "architecture_type": "mvvmi" },
                        { "name": "LTLibraryListTests", "swift_language_mode": "6", "test_framework": "swift_testing", "navigation_type": "N/A", "architecture_type": "mvvmi" }
                    ]
                },
                {
                    "name": "LTVulnerabilities",
                    "source": "spm",
                    "is_modularized": true,
                    "custom_fields": { "swift_version": "6.0" },
                    "targets": [
                        { "name": "LTVulnerabilities", "swift_language_mode": "6", "test_framework": "swift_testing", "navigation_type": "swiftui", "architecture_type": "mvvmi" },
                        { "name": "LTVulnerabilitiesDomain", "swift_language_mode": "5", "test_framework": "swift_testing", "navigation_type": "N/A", "architecture_type": "mvvmi" },
                        { "name": "LTVulnerabilitiesMocks", "swift_language_mode": "5", "test_framework": "swift_testing", "navigation_type": "N/A", "architecture_type": "mvvmi" },
                        { "name": "LTVulnerabilitiesTests", "swift_language_mode": "6", "test_framework": "swift_testing", "navigation_type": "N/A", "architecture_type": "mvvmi" }
                    ]
                },
                {
                    "name": "LTDashboard",
                    "source": "spm",
                    "is_modularized": true,
                    "custom_fields": { "swift_version": "6.0" },
                    "targets": [
                        { "name": "LTDashboard", "swift_language_mode": "6", "test_framework": "swift_testing", "navigation_type": "swiftui", "architecture_type": "mvvmi" },
                        { "name": "LTDashboardDomain", "swift_language_mode": "6", "test_framework": "swift_testing", "navigation_type": "N/A", "architecture_type": "mvvmi" },
                        { "name": "LTDashboardWidgets", "swift_language_mode": "6", "test_framework": "swift_testing", "navigation_type": "swiftui", "architecture_type": "mvvmi" },
                        { "name": "LTDashboardTests", "swift_language_mode": "6", "test_framework": "swift_testing", "navigation_type": "N/A", "architecture_type": "mvvmi" }
                    ]
                },
                {
                    "name": "LTSettings",
                    "source": "spm",
                    "is_modularized": true,
                    "custom_fields": { "swift_version": "6.0" },
                    "targets": [
                        { "name": "LTSettings", "swift_language_mode": "6", "test_framework": "swift_testing", "navigation_type": "swiftui", "architecture_type": "mvvmi" },
                        { "name": "LTSettingsTests", "swift_language_mode": "6", "test_framework": "swift_testing", "navigation_type": "N/A", "architecture_type": "mvvmi" }
                    ]
                },
                {
                    "name": "LTOnboarding",
                    "source": "spm",
                    "is_modularized": true,
                    "custom_fields": { "swift_version": "6.0" },
                    "targets": [
                        { "name": "LTOnboarding", "swift_language_mode": "6", "test_framework": "swift_testing", "navigation_type": "swiftui", "architecture_type": "mvvmi" },
                        { "name": "LTOnboardingTests", "swift_language_mode": "6", "test_framework": "swift_testing", "navigation_type": "N/A", "architecture_type": "mvvmi" }
                    ]
                },
                {
                    "name": "LTReports",
                    "source": "spm",
                    "is_modularized": true,
                    "custom_fields": { "swift_version": "6.0" },
                    "targets": [
                        { "name": "LTReports", "swift_language_mode": "6", "test_framework": "swift_testing", "navigation_type": "swiftui", "architecture_type": "mvvmi" },
                        { "name": "LTReportsDomain", "swift_language_mode": "6", "test_framework": "swift_testing", "navigation_type": "N/A", "architecture_type": "mvvmi" },
                        { "name": "LTReportsExport", "swift_language_mode": "5", "test_framework": "swift_testing", "navigation_type": "N/A", "architecture_type": "mvvmi" },
                        { "name": "LTReportsTests", "swift_language_mode": "6", "test_framework": "swift_testing", "navigation_type": "N/A", "architecture_type": "mvvmi" }
                    ]
                },
                {
                    "name": "LTProfile",
                    "source": "spm",
                    "is_modularized": true,
                    "custom_fields": { "swift_version": "6.0" },
                    "targets": [
                        { "name": "LTProfile", "swift_language_mode": "6", "test_framework": "swift_testing", "navigation_type": "swiftui", "architecture_type": "mvvmi" },
                        { "name": "LTProfileTests", "swift_language_mode": "6", "test_framework": "swift_testing", "navigation_type": "N/A", "architecture_type": "mvvmi" }
                    ]
                }
            ],
            "legacy_modules": []
        };

        // Historical snapshots showing 6 months of evolution
        const history = {
            "snapshots": [
                {
                    "date": "2025-07-01T10:00:00Z",
                    "spm_modules_count": 3,
                    "legacy_modules_count": 11,
                    "total_targets": 5,
                    "custom_metrics": {
                        "swift_version_6.0_count": 0,
                        "swift_version_5.9_count": 3,
                        "swift_version_5.8_count": 0,
                        "swift_language_mode_6_count": 0,
                        "swift_language_mode_5_count": 5,
                        "architecture_type_mvvmi_count": 0,
                        "architecture_type_mvc_count": 16,
                        "architecture_type_none_count": 0,
                        "navigation_type_swiftui_count": 0,
                        "navigation_type_uikit_count": 16,
                        "test_framework_swift_testing_count": 0,
                        "test_framework_xctest_count": 5,
                        "test_framework_none_count": 11
                    }
                },
                {
                    "date": "2025-08-01T10:00:00Z",
                    "spm_modules_count": 5,
                    "legacy_modules_count": 9,
                    "total_targets": 11,
                    "custom_metrics": {
                        "swift_version_6.0_count": 3,
                        "swift_version_5.9_count": 2,
                        "swift_version_5.8_count": 0,
                        "swift_language_mode_6_count": 6,
                        "swift_language_mode_5_count": 5,
                        "architecture_type_mvvmi_count": 6,
                        "architecture_type_mvc_count": 14,
                        "architecture_type_none_count": 0,
                        "navigation_type_swiftui_count": 0,
                        "navigation_type_uikit_count": 16,
                        "test_framework_swift_testing_count": 6,
                        "test_framework_xctest_count": 5,
                        "test_framework_none_count": 9
                    }
                },
                {
                    "date": "2025-09-01T10:00:00Z",
                    "spm_modules_count": 8,
                    "legacy_modules_count": 6,
                    "total_targets": 20,
                    "custom_metrics": {
                        "swift_version_6.0_count": 6,
                        "swift_version_5.9_count": 2,
                        "swift_version_5.8_count": 0,
                        "swift_language_mode_6_count": 14,
                        "swift_language_mode_5_count": 6,
                        "architecture_type_mvvmi_count": 14,
                        "architecture_type_mvc_count": 9,
                        "architecture_type_none_count": 0,
                        "navigation_type_swiftui_count": 2,
                        "navigation_type_uikit_count": 14,
                        "test_framework_swift_testing_count": 14,
                        "test_framework_xctest_count": 4,
                        "test_framework_none_count": 5
                    }
                },
                {
                    "date": "2025-10-01T10:00:00Z",
                    "spm_modules_count": 11,
                    "legacy_modules_count": 3,
                    "total_targets": 28,
                    "custom_metrics": {
                        "swift_version_6.0_count": 9,
                        "swift_version_5.9_count": 2,
                        "swift_version_5.8_count": 0,
                        "swift_language_mode_6_count": 22,
                        "swift_language_mode_5_count": 6,
                        "architecture_type_mvvmi_count": 22,
                        "architecture_type_mvc_count": 4,
                        "architecture_type_none_count": 2,
                        "navigation_type_swiftui_count": 4,
                        "navigation_type_uikit_count": 12,
                        "test_framework_swift_testing_count": 24,
                        "test_framework_xctest_count": 2,
                        "test_framework_none_count": 2
                    }
                },
                {
                    "date": "2025-11-01T10:00:00Z",
                    "spm_modules_count": 13,
                    "legacy_modules_count": 1,
                    "total_targets": 33,
                    "custom_metrics": {
                        "swift_version_6.0_count": 12,
                        "swift_version_5.9_count": 1,
                        "swift_version_5.8_count": 0,
                        "swift_language_mode_6_count": 27,
                        "swift_language_mode_5_count": 6,
                        "architecture_type_mvvmi_count": 30,
                        "architecture_type_mvc_count": 0,
                        "architecture_type_none_count": 3,
                        "navigation_type_swiftui_count": 7,
                        "navigation_type_uikit_count": 6,
                        "test_framework_swift_testing_count": 31,
                        "test_framework_xctest_count": 1,
                        "test_framework_none_count": 1
                    }
                },
                {
                    "date": "2025-12-25T10:30:00Z",
                    "spm_modules_count": 14,
                    "legacy_modules_count": 0,
                    "total_targets": 36,
                    "custom_metrics": {
                        "swift_version_6.0_count": 14,
                        "swift_version_5.9_count": 0,
                        "swift_version_5.8_count": 0,
                        "swift_language_mode_6_count": 29,
                        "swift_language_mode_5_count": 7,
                        "architecture_type_mvvmi_count": 33,
                        "architecture_type_mvc_count": 0,
                        "architecture_type_none_count": 3,
                        "navigation_type_swiftui_count": 10,
                        "navigation_type_uikit_count": 0,
                        "test_framework_swift_testing_count": 36,
                        "test_framework_xctest_count": 0,
                        "test_framework_none_count": 0
                    }
                }
            ]
        };

        const expanded = new Set();
        let charts = [];

        // Fields metadata from JSON - auto-generated from Swift Rule metadata
        const fieldsMeta = data.fields_meta || {};

        // ============================================================
        // DATA-DRIVEN TEMPLATE
        // Everything below is auto-generated from fields_meta
        // ============================================================

        function switchTab(tabId) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelector(`[onclick="switchTab('${tabId}')"]`).classList.add('active');
            document.getElementById(`tab-${tabId}`).classList.add('active');
            if (tabId === 'charts') renderCharts();
            if (tabId === 'compare') renderCompare();
        }

        function init() {
            const fieldsCount = Object.keys(fieldsMeta).length;
            document.getElementById('meta').textContent = `Generated: ${new Date(data.generated_at).toLocaleString()} | ${fieldsCount} custom fields | ${history.snapshots.length} snapshots`;
            document.getElementById('spm-count').textContent = data.spm_modules.length;
            document.getElementById('legacy-count').textContent = data.legacy_modules.length;

            if (data.legacy_modules.length > 0) {
                document.getElementById('legacy-section').style.display = 'block';
            }

            renderFilters();
            renderStats();
            renderTableHeaders();
            renderSPM();
            renderLegacy();
        }

        // Auto-generate filters from filterable fields (100% data-driven)
        function renderFilters() {
            const filtersDiv = document.getElementById('filters');
            let html = '<input type="text" id="search-spm" placeholder="Search...">';

            // Custom field filters from metadata - 100% data-driven
            Object.entries(fieldsMeta).filter(([k, f]) => f.is_filterable).forEach(([fieldId, field]) => {
                const values = new Set();
                const isModuleLevel = field.level === 'module';

                data.spm_modules.forEach(m => {
                    if (isModuleLevel) {
                        // Module-level field from custom_fields
                        if (m.custom_fields?.[fieldId]) values.add(m.custom_fields[fieldId]);
                    } else {
                        // Target-level field
                        m.targets.forEach(t => {
                            if (t[fieldId]) values.add(t[fieldId]);
                        });
                    }
                });
                data.legacy_modules.forEach(m => {
                    if (m[fieldId]) values.add(m[fieldId]);
                    if (m.custom_fields?.[fieldId]) values.add(m.custom_fields[fieldId]);
                });

                if (values.size > 0) {
                    html += `<select id="filter-${fieldId}"><option value="">All ${field.label}</option>`;
                    [...values].sort().forEach(v => {
                        const label = field.values?.[v]?.label || v;
                        html += `<option value="${v}">${label}</option>`;
                    });
                    html += '</select>';
                }
            });

            filtersDiv.innerHTML = html;

            // Add event listeners
            document.getElementById('search-spm')?.addEventListener('input', renderSPM);
            Object.keys(fieldsMeta).filter(k => fieldsMeta[k].is_filterable).forEach(fieldId => {
                document.getElementById(`filter-${fieldId}`)?.addEventListener('change', renderSPM);
            });
        }

        // Auto-generate table headers from showInTable fields (100% data-driven)
        function renderTableHeaders() {
            const tableFields = Object.entries(fieldsMeta).filter(([k, f]) => f.show_in_table);

            let spmHeader = '<tr><th>Module / Target</th>';
            tableFields.forEach(([fieldId, field]) => {
                spmHeader += `<th>${field.label}</th>`;
            });
            spmHeader += '</tr>';
            document.getElementById('spm-thead').innerHTML = spmHeader;

            let legacyHeader = '<tr><th>Module</th>';
            tableFields.forEach(([fieldId, field]) => {
                legacyHeader += `<th>${field.label}</th>`;
            });
            legacyHeader += '</tr>';
            document.getElementById('legacy-thead').innerHTML = legacyHeader;
        }

        // Stats are now 100% data-driven - no hardcoded Swift stats
        function renderStats() {
            let totalTargets = 0;
            data.spm_modules.forEach(m => totalTargets += m.targets.length);
            const prev = history.snapshots.length > 1 ? history.snapshots[history.snapshots.length - 2] : null;

            let html = `
                <div class="stat"><div class="stat-value">${data.spm_modules.length}</div><div class="stat-label">SPM Modules</div>${prev ? formatDelta(data.spm_modules.length - prev.spm_modules_count) : ''}</div>
                <div class="stat"><div class="stat-value">${totalTargets}</div><div class="stat-label">Total Targets</div>${prev ? formatDelta(totalTargets - prev.total_targets) : ''}</div>
            `;

            if (data.legacy_modules.length > 0) {
                html += `<div class="stat"><div class="stat-value">${data.legacy_modules.length}</div><div class="stat-label">Legacy Modules</div>${prev ? formatDelta(data.legacy_modules.length - prev.legacy_modules_count, true) : ''}</div>`;
            }

            document.getElementById('stats').innerHTML = html;
        }

        function formatDelta(delta, inverted = false) {
            if (delta === 0) return '';
            const isGood = inverted ? delta < 0 : delta > 0;
            const cls = isGood ? 'positive' : 'negative';
            const sign = delta > 0 ? '+' : '';
            return `<span class="stat-delta ${cls}">${sign}${delta}</span>`;
        }

        // Data-driven badge using fields_meta (100% data-driven)
        function badge(fieldId, value) {
            const field = fieldsMeta[fieldId];
            if (!field) {
                return `<span class="badge badge-gray">${value}</span>`;
            }
            const valueMeta = field.values?.[value];
            const color = valueMeta?.color || 'gray';
            const label = valueMeta?.label || value;
            return `<span class="badge badge-${color}" title="${field.description || ''}">${label}</span>`;
        }

        function toggleExpand(moduleName) {
            if (expanded.has(moduleName)) expanded.delete(moduleName);
            else expanded.add(moduleName);
            renderSPM();
        }

        // Get active filters (100% data-driven)
        function getActiveFilters() {
            const filters = {};
            filters.search = (document.getElementById('search-spm')?.value || '').toLowerCase();
            Object.keys(fieldsMeta).filter(k => fieldsMeta[k].is_filterable).forEach(fieldId => {
                filters[fieldId] = document.getElementById(`filter-${fieldId}`)?.value || '';
            });
            return filters;
        }

        // Render SPM modules table (100% data-driven)
        function renderSPM() {
            const filters = getActiveFilters();
            const tableFields = Object.entries(fieldsMeta).filter(([k, f]) => f.show_in_table);
            const moduleFields = tableFields.filter(([k, f]) => f.level === 'module');
            const targetFields = tableFields.filter(([k, f]) => f.level !== 'module');
            let html = '';

            data.spm_modules.forEach(m => {
                // Check module-level filters
                for (const [fieldId, field] of moduleFields) {
                    const filterVal = filters[fieldId];
                    if (filterVal && m.custom_fields?.[fieldId] !== filterVal) return;
                }

                // Check target-level filters
                const matchingTargets = m.targets.filter(t => {
                    for (const [fieldId, val] of Object.entries(filters)) {
                        if (fieldId === 'search') continue;
                        const field = fieldsMeta[fieldId];
                        if (field?.level === 'module') continue; // Already handled
                        if (val && t[fieldId] !== val) return false;
                    }
                    return true;
                });

                const hasTargetFilters = targetFields.some(([fieldId]) => filters[fieldId]);
                if (hasTargetFilters && matchingTargets.length === 0) return;

                const moduleMatches = m.name.toLowerCase().includes(filters.search);
                const targetMatches = matchingTargets.some(t => t.name.toLowerCase().includes(filters.search));
                if (filters.search && !moduleMatches && !targetMatches) return;

                const isExpanded = expanded.has(m.name);
                const expandIcon = `<span class="expand-btn">${isExpanded ? 'â–¼' : 'â–¶'}</span>`;

                // Module row with module-level fields
                html += `<tr class="module-row" onclick="toggleExpand('${m.name}')">
                    <td>${expandIcon}<span class="module-name">${m.name}</span> <span class="badge badge-purple">${m.targets.length} target${m.targets.length > 1 ? 's' : ''}</span></td>`;
                tableFields.forEach(([fieldId, field]) => {
                    if (field.level === 'module') {
                        const val = m.custom_fields?.[fieldId];
                        html += `<td onclick="showField('${fieldId}')" style="cursor:pointer">${val !== undefined ? badge(fieldId, val) : '-'}</td>`;
                    } else {
                        html += '<td>-</td>';
                    }
                });
                html += '</tr>';

                if (isExpanded) {
                    const targetsToShow = filters.search && !moduleMatches
                        ? matchingTargets.filter(t => t.name.toLowerCase().includes(filters.search))
                        : matchingTargets;
                    targetsToShow.forEach(t => {
                        html += `<tr class="target-row">
                            <td><span class="target-name">â†³ ${t.name}</span></td>`;
                        tableFields.forEach(([fieldId, field]) => {
                            if (field.level === 'module') {
                                html += '<td></td>'; // Empty for target rows
                            } else {
                                const val = t[fieldId];
                                html += `<td onclick="showField('${fieldId}')" style="cursor:pointer">${val !== undefined ? badge(fieldId, val) : '-'}</td>`;
                            }
                        });
                        html += '</tr>';
                    });
                }
            });
            const colCount = tableFields.length + 1;
            document.getElementById('spm-tbody').innerHTML = html || `<tr><td colspan="${colCount}" style="text-align:center;color:#8b949e;">No modules found</td></tr>`;
        }

        function renderLegacy() {
            const tableFields = Object.entries(fieldsMeta).filter(([k, f]) => f.show_in_table);
            let html = '';
            data.legacy_modules.forEach(m => {
                html += `<tr><td><strong>${m.name}</strong></td>`;
                tableFields.forEach(([fieldId, field]) => {
                    const val = m[fieldId];
                    html += `<td onclick="showField('${fieldId}')" style="cursor:pointer">${val !== undefined ? badge(fieldId, val) : '-'}</td>`;
                });
                html += '</tr>';
            });
            document.getElementById('legacy-tbody').innerHTML = html;
        }

        // Charts - 100% auto-generated from fields with showInChart
        function renderCharts() {
            const container = document.getElementById('charts-container');
            const chartFields = Object.entries(fieldsMeta).filter(([k, f]) => f.show_in_chart);

            if (history.snapshots.length < 2) {
                container.innerHTML = `<div class="no-data">
                    <div class="no-data-icon">ðŸ“ˆ</div>
                    <h3>Not enough data for charts</h3>
                    <p>Run the tracker multiple times to see evolution graphs.</p>
                </div>`;
                return;
            }

            charts.forEach(c => c.destroy());
            charts = [];
            const labels = history.snapshots.map(s => new Date(s.date).toLocaleDateString('en-US', { month: 'short', year: '2-digit' }));

            let html = '<div class="charts-grid">';
            html += `<div class="chart-card"><h3>Module Distribution</h3><div class="chart-container"><canvas id="chart-modules"></canvas></div></div>`;

            // 100% data-driven charts from fields_meta
            chartFields.forEach(([fieldId, field]) => {
                html += `<div class="chart-card"><h3>${field.label} Evolution</h3><div class="chart-container"><canvas id="chart-${fieldId}"></canvas></div></div>`;
            });

            html += '</div>';
            container.innerHTML = html;

            // Create module distribution chart
            createChart('chart-modules', labels, [
                { label: 'SPM Modules', data: history.snapshots.map(s => s.spm_modules_count), color: '#58a6ff' },
                { label: 'Legacy Modules', data: history.snapshots.map(s => s.legacy_modules_count), color: '#f0883e' }
            ]);

            // Create custom field charts (100% data-driven)
            chartFields.forEach(([fieldId, field]) => {
                const values = field.values ? Object.keys(field.values) : [];
                const datasets = values.map(v => ({
                    label: field.values[v]?.label || v,
                    data: history.snapshots.map(s => s.custom_metrics?.[`${fieldId}_${v}_count`] || 0),
                    color: colorForValue(field.values[v]?.color)
                }));
                createChart(`chart-${fieldId}`, labels, datasets, field.chart_type || 'line');
            });
        }

        function createChart(canvasId, labels, datasets, type = 'line', stacked = false) {
            const ctx = document.getElementById(canvasId);
            if (!ctx) return;
            charts.push(new Chart(ctx, {
                type: type === 'area' ? 'line' : type,
                data: {
                    labels,
                    datasets: datasets.map(ds => ({
                        label: ds.label,
                        data: ds.data,
                        borderColor: ds.color,
                        backgroundColor: type === 'bar' ? ds.color : (type === 'area' ? ds.color + '1a' : undefined),
                        fill: type === 'area',
                        tension: 0.3
                    }))
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { labels: { color: '#c9d1d9' } } },
                    scales: {
                        x: { ticks: { color: '#8b949e' }, grid: { color: '#21262d' }, stacked },
                        y: { ticks: { color: '#8b949e' }, grid: { color: '#21262d' }, beginAtZero: true, stacked }
                    }
                }
            }));
        }

        function colorForValue(colorName) {
            const colors = { green: '#3fb950', yellow: '#9e6a03', orange: '#f0883e', red: '#f85149', blue: '#58a6ff', gray: '#8b949e', purple: '#a371f7' };
            return colors[colorName] || '#8b949e';
        }

        // Comparison - 100% data-driven
        let compareFromIdx = 0;
        let compareToIdx = Math.max(0, history.snapshots.length - 1);

        function renderCompare() {
            const container = document.getElementById('compare-container');
            const comparisonFields = Object.entries(fieldsMeta).filter(([k, f]) => f.show_in_comparison);

            if (history.snapshots.length < 2) {
                container.innerHTML = `<div class="no-data">
                    <div class="no-data-icon">ðŸ”„</div>
                    <h3>Not enough data for comparison</h3>
                    <p>Run the tracker again to compare with previous results.</p>
                </div>`;
                return;
            }

            const from = history.snapshots[compareFromIdx];
            const to = history.snapshots[compareToIdx];

            const dateOptions = history.snapshots.map((s, i) =>
                `<option value="${i}">${new Date(s.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}</option>`
            ).join('');

            let html = `
                <div style="display:flex;gap:20px;align-items:center;margin-bottom:25px;flex-wrap:wrap;">
                    <div style="display:flex;align-items:center;gap:10px;">
                        <label style="color:#8b949e;font-size:14px;">From:</label>
                        <select id="compare-from" style="min-width:150px;">${dateOptions}</select>
                    </div>
                    <div style="display:flex;align-items:center;gap:10px;">
                        <label style="color:#8b949e;font-size:14px;">To:</label>
                        <select id="compare-to" style="min-width:150px;">${dateOptions}</select>
                    </div>
                    <div style="background:#21262d;padding:8px 16px;border-radius:6px;color:#58a6ff;font-size:13px;">
                        <span style="color:#8b949e;">Period:</span> ${Math.round((new Date(to.date) - new Date(from.date)) / (1000 * 60 * 60 * 24))} days
                    </div>
                </div>
                <div class="comparison-grid">
                    <div class="comparison-card">
                        <h4>Modules</h4>
                        ${compareRow('SPM Modules', to.spm_modules_count, from.spm_modules_count)}
                        ${compareRow('Legacy Modules', to.legacy_modules_count, from.legacy_modules_count, true)}
                        ${compareRow('Total Targets', to.total_targets, from.total_targets)}
                    </div>
            `;

            // 100% data-driven comparison cards from fields_meta
            comparisonFields.forEach(([fieldId, field]) => {
                html += `<div class="comparison-card"><h4>${field.label}</h4>`;
                if (field.values) {
                    Object.entries(field.values).forEach(([v, meta]) => {
                        const toVal = to.custom_metrics?.[`${fieldId}_${v}_count`] || 0;
                        const fromVal = from.custom_metrics?.[`${fieldId}_${v}_count`] || 0;
                        const inverted = field.inverted_comparison && meta.color !== 'green';
                        html += compareRow(meta.label, toVal, fromVal, inverted);
                    });
                }
                html += '</div>';
            });

            html += '</div>';

            container.innerHTML = html;
            document.getElementById('compare-from').value = compareFromIdx;
            document.getElementById('compare-to').value = compareToIdx;
            document.getElementById('compare-from').addEventListener('change', (e) => { compareFromIdx = parseInt(e.target.value); renderCompare(); });
            document.getElementById('compare-to').addEventListener('change', (e) => { compareToIdx = parseInt(e.target.value); renderCompare(); });
        }

        function compareRow(label, curr, prev, inverted = false) {
            const delta = (curr || 0) - (prev || 0);
            const isGood = inverted ? delta < 0 : delta > 0;
            const deltaClass = delta === 0 ? 'delta-neutral' : (isGood ? 'delta-positive' : 'delta-negative');
            const sign = delta > 0 ? '+' : '';
            return `<div class="comparison-row">
                <span class="comparison-label">${label}</span>
                <div class="comparison-values">
                    <span class="comparison-old">${prev || 0}</span>
                    <span class="comparison-arrow">â†’</span>
                    <span class="comparison-new">${curr || 0}</span>
                    <span class="comparison-delta ${deltaClass}">${sign}${delta}</span>
                </div>
            </div>`;
        }

        // Modal for field info
        function showField(fieldId) {
            const field = fieldsMeta[fieldId];
            if (!field) return;
            document.getElementById('modal-title').textContent = field.label;
            let html = `<div class="field-info"><p>${field.description || ''}</p></div>`;
            if (field.values) {
                html += '<div class="field-info"><h4>Values</h4><div style="margin-top:10px;">';
                for (const [k, v] of Object.entries(field.values)) {
                    const desc = v.description || k;
                    html += `<div style="margin-bottom:12px;"><span class="badge badge-${v.color}">${v.label}</span><p style="margin-top:4px;color:#8b949e;font-size:12px;">${desc}</p></div>`;
                }
                html += '</div></div>';
            }
            document.getElementById('modal-body').innerHTML = html;
            document.getElementById('modal').classList.add('active');
        }

        function closeModal() { document.getElementById('modal').classList.remove('active'); }
        document.getElementById('modal').addEventListener('click', e => { if (e.target.id === 'modal') closeModal(); });

        init();
    </script>
</body>
</html>
